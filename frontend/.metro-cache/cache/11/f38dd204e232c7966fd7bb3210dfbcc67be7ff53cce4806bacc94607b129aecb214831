{"dependencies":[{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":174},"end":{"line":7,"column":69,"index":243}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"expo-constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":244},"end":{"line":8,"column":39,"index":283}}],"key":"pPv5KzfRT0rL6NCr7G9k0o4d1W8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,_i,a,m,_e,d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),_e.isWebPushSupported=s,_e.getNotificationPermission=c,_e.registerServiceWorker=u,_e.requestNotificationPermission=l,_e.getVapidPublicKey=b,_e.subscribeToWebPush=h,_e.unsubscribeFromWebPush=async function(e){try{const t=await navigator.serviceWorker.ready,i=await t.pushManager.getSubscription();i&&await i.unsubscribe();const s=n();return await fetch(`${s}/web-push/unsubscribe`,{method:'DELETE',headers:{Authorization:e}}),await o.default.removeItem('web_push_subscribed'),console.log('[WebPush] Dessubscrit correctament'),!0}catch(e){return console.error('[WebPush] Error dessubscrivint:',e),!1}},_e.isSubscribedToWebPush=p,_e.initWebPushIfPermitted=async function(e){if(!s())return;if('granted'===c()){await p()||(console.log('[WebPush] Re-subscrivint usuari amb perm\\xeds existent...'),await h(e))}},r(d[0]);var o=e(r(d[1])),t=e(r(d[2]));const n=()=>{const e=t.default.expoConfig?.extra?.EXPO_PUBLIC_BACKEND_URL||process.env.EXPO_PUBLIC_BACKEND_URL;return e?`${e}/api`:'/api'};function i(e){const o=(e+'='.repeat((4-e.length%4)%4)).replace(/-/g,'+').replace(/_/g,'/'),t=window.atob(o),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}function s(){return'serviceWorker'in navigator&&'PushManager'in window&&'Notification'in window}function c(){return'Notification'in window?Notification.permission:null}async function u(){if(!('serviceWorker'in navigator))return console.log('[WebPush] Service Worker no suportat'),null;try{const e=await navigator.serviceWorker.register('/sw.js',{scope:'/'});return console.log('[WebPush] Service Worker registrat:',e.scope),e}catch(e){return console.error('[WebPush] Error registrant Service Worker:',e),null}}async function l(){if(!('Notification'in window))return'denied';const e=await Notification.requestPermission();return console.log('[WebPush] Perm\\xeds de notificacions:',e),e}async function b(){try{const e=n();console.log('[WebPush] Obtenint clau VAPID de:',`${e}/web-push/vapid-public-key`);const o=await fetch(`${e}/web-push/vapid-public-key`);if(!o.ok)throw new Error('No s\\'ha pogut obtenir la clau VAPID');return(await o.json()).vapidPublicKey}catch(e){return console.error('[WebPush] Error obtenint clau VAPID:',e),null}}async function h(e){if(!s())return console.log('[WebPush] Web Push no suportat'),!1;let t=e;if(t||'undefined'==typeof localStorage||(t=localStorage.getItem('reusapp_auth_token')||void 0,console.log('[WebPush] Token obtingut de localStorage:',t?'S\\xcd':'NO')),!t)return console.error('[WebPush] No hi ha token d\\'autenticaci\\xf3!'),!1;try{console.log('[WebPush] 1. Registrant Service Worker...');const e=await u();if(!e)throw new Error('No s\\'ha pogut registrar el Service Worker');console.log('[WebPush] Service Worker registrat correctament'),console.log('[WebPush] 2. Sol\\xb7licitant perm\\xeds...');const s=await l();if('granted'!==s)return console.log('[WebPush] Perm\\xeds de notificacions no concedit:',s),!1;console.log('[WebPush] Perm\\xeds concedit!'),console.log('[WebPush] 3. Obtenint clau VAPID...');const c=await b();if(!c)throw new Error('No s\\'ha pogut obtenir la clau VAPID');console.log('[WebPush] Clau VAPID obtinguda'),console.log('[WebPush] 4. Creant subscripci\\xf3 push...');const h=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i(c)});console.log('[WebPush] Subscripci\\xf3 creada:',h.endpoint),console.log('[WebPush] 5. Enviant subscripci\\xf3 al servidor...');const p=h.toJSON(),P=n();console.log('[WebPush] API Base:',P),console.log('[WebPush] Token (primers 20 chars):',t.substring(0,20)+'...');const f=await fetch(`${P}/web-push/subscribe`,{method:'POST',headers:{'Content-Type':'application/json',Authorization:t},body:JSON.stringify({endpoint:h.endpoint,keys:{p256dh:p.keys?.p256dh,auth:p.keys?.auth}})});if(console.log('[WebPush] Resposta del servidor:',f.status),!f.ok){const e=await f.text();throw console.error('[WebPush] Error del servidor:',e),new Error('Error guardant subscripci\\xf3 al servidor: '+e)}return await o.default.setItem('web_push_subscribed','true'),console.log('[WebPush] \\u2705 Subscripci\\xf3 completada amb \\xe8xit'),!0}catch(e){return console.error('[WebPush] Error subscrivint:',e),!1}}async function p(){if(!('serviceWorker'in navigator))return!1;try{const e=await navigator.serviceWorker.ready;return null!==await e.pushManager.getSubscription()}catch(e){return!1}}});","lineCount":1,"map":[[1,144,45,0,"_e"],[1,147,45,0,"isWebPushSupported"],[1,168,58,0,"_e"],[1,171,58,0,"getNotificationPermission"],[1,199,66,0,"_e"],[1,202,66,0,"registerServiceWorker"],[1,226,88,0,"_e"],[1,229,88,0,"requestNotificationPermission"],[1,261,101,0,"_e"],[1,264,101,0,"getVapidPublicKey"],[1,284,120,0,"_e"],[1,287,120,0,"subscribeToWebPush"],[1,308,218,0,"_e"],[1,311,218,0,"unsubscribeFromWebPush"],[1,334,218,7,"async"],[1,349,218,45,"authToken"],[1,352,221,2],[1,356,222,4],[1,362,222,10,"registration"],[1,370,222,31,"navigator"],[1,380,222,41,"serviceWorker"],[1,394,222,55,"ready"],[1,400,223,10,"subscription"],[1,408,223,31,"registration"],[1,410,223,44,"pushManager"],[1,422,223,56,"getSubscription"],[1,440,225,8,"subscription"],[1,449,226,12,"subscription"],[1,451,226,25,"unsubscribe"],[1,465,230,4],[1,471,230,10,"apiBase"],[1,473,230,20,"getApiBase"],[1,477,241,4],[1,490,231,10,"fetch"],[1,496,231,16],[1,499,231,19,"apiBase"],[1,524,231,51],[1,525,232,6,"method"],[1,532,232,14],[1,541,233,6,"headers"],[1,549,233,15],[1,550,234,8,"Authorization"],[1,564,234,25,"authToken"],[1,575,238,10,"AsyncStorage"],[1,577,238,22,"default"],[1,585,238,23,"removeItem"],[1,596,238,34],[1,619,240,4,"console"],[1,627,240,12,"log"],[1,631,240,16],[1,670,241,11],[1,671,243,2],[1,672,243,4],[1,678,243,11,"error"],[1,681,245,4],[1,688,244,4,"console"],[1,696,244,12,"error"],[1,702,244,18],[1,736,244,53,"error"],[1,740,245,11],[1,741,246,2],[1,742,247,0],[1,744,252,0,"_e"],[1,747,252,0,"isSubscribedToWebPush"],[1,771,269,0,"_e"],[1,774,269,0,"initWebPushIfPermitted"],[1,797,269,7,"async"],[1,812,269,45,"authToken"],[1,815,270,2],[1,819,270,7,"isWebPushSupported"],[1,823,270,29],[1,830,273,2],[1,833,273,21],[1,845,272,21,"getNotificationPermission"],[1,849,273,32],[1,856,274,31,"isSubscribedToWebPush"],[1,862,276,6,"console"],[1,870,276,14,"log"],[1,874,276,18],[1,941,277,12,"subscribeToWebPush"],[1,943,277,31,"authToken"],[1,946,279,2],[1,947,280,0],[1,949,280,1,"r"],[1,951,280,1,"d"],[1,953,280,1],[1,957,7,0],[1,961,7,0,"AsyncStorage"],[1,963,7,0,"_interopDefault"],[1,965,7,0,"r"],[1,967,7,0,"d"],[1,969,7,0],[1,974,8,0,"Constants"],[1,976,8,0,"_interopDefault"],[1,978,8,0,"r"],[1,980,8,0,"d"],[1,982,8,0],[1,987,11,0],[1,993,11,6,"getApiBase"],[1,995,11,19,"getApiBase"],[1,1000,13,2],[1,1006,13,8,"envUrl"],[1,1008,13,17,"Constants"],[1,1010,13,26,"default"],[1,1018,13,27,"expoConfig"],[1,1030,13,39,"extra"],[1,1037,13,46,"EXPO_PUBLIC_BACKEND_URL"],[1,1062,14,17,"process"],[1,1070,14,25,"env"],[1,1074,14,29,"EXPO_PUBLIC_BACKEND_URL"],[1,1098,16,2],[1,1105,16,6,"envUrl"],[1,1107,17,11],[1,1110,17,14,"envUrl"],[1,1118,21,9],[1,1126,27,0],[1,1135,27,9,"urlBase64ToUint8Array"],[1,1137,27,31,"base64String"],[1,1140,28,2],[1,1146,29,8,"base64"],[1,1149,29,18,"base64String"],[1,1151,28,18],[1,1155,28,22,"repeat"],[1,1163,28,30],[1,1165,28,34,"base64String"],[1,1167,28,47,"length"],[1,1174,28,56],[1,1177,28,61],[1,1181,30,5,"replace"],[1,1189,30,13],[1,1194,30,19],[1,1199,31,5,"replace"],[1,1207,31,13],[1,1212,31,19],[1,1217,33,8,"rawData"],[1,1219,33,18,"window"],[1,1226,33,25,"atob"],[1,1231,33,30,"base64"],[1,1234,34,8,"outputArray"],[1,1236,34,22],[1,1240,34,26,"Uint8Array"],[1,1251,34,37,"rawData"],[1,1253,34,45,"length"],[1,1261,36,2],[1,1265,36,7],[1,1269,36,11,"i"],[1,1271,36,15],[1,1273,36,18,"i"],[1,1275,36,22,"rawData"],[1,1277,36,30,"length"],[1,1286,36,40,"i"],[1,1288,37,4,"outputArray"],[1,1290,37,16,"i"],[1,1293,37,21,"rawData"],[1,1295,37,29,"charCodeAt"],[1,1306,37,40,"i"],[1,1309,39,2],[1,1316,39,9,"outputArray"],[1,1317,40,0],[1,1318,45,7],[1,1327,45,16,"isWebPushSupported"],[1,1331,48,2],[1,1337,49,4],[1,1355,49,23,"navigator"],[1,1366,50,4],[1,1382,50,21,"window"],[1,1390,51,4],[1,1407,51,22,"window"],[1,1413,53,0],[1,1414,58,7],[1,1423,58,16,"getNotificationPermission"],[1,1427,59,2],[1,1433,59,33],[1,1450,59,51,"window"],[1,1457,60,9,"Notification"],[1,1470,60,22,"permission"],[1,1481,59,67],[1,1485,61,0],[1,1486,66,7,"async"],[1,1501,66,22,"registerServiceWorker"],[1,1505,67,2],[1,1510,67,33],[1,1528,67,52,"navigator"],[1,1539,69,4],[1,1546,68,4,"console"],[1,1554,68,12,"log"],[1,1558,68,16],[1,1598,69,11],[1,1603,72,2],[1,1607,73,4],[1,1613,73,10,"registration"],[1,1621,73,31,"navigator"],[1,1631,73,41,"serviceWorker"],[1,1645,73,55,"register"],[1,1654,73,64],[1,1663,73,74],[1,1664,74,6,"scope"],[1,1670,74,13],[1,1676,78,4],[1,1683,77,4,"console"],[1,1691,77,12,"log"],[1,1695,77,16],[1,1733,77,55,"registration"],[1,1735,77,68,"scope"],[1,1742,78,11,"registration"],[1,1743,79,2],[1,1744,79,4],[1,1750,79,11,"error"],[1,1753,81,4],[1,1760,80,4,"console"],[1,1768,80,12,"error"],[1,1774,80,18],[1,1819,80,64,"error"],[1,1822,81,11],[1,1826,82,2],[1,1827,83,0],[1,1828,88,7,"async"],[1,1843,88,22,"requestNotificationPermission"],[1,1847,89,2],[1,1852,89,33],[1,1869,89,51,"window"],[1,1877,90,4],[1,1883,90,11],[1,1892,93,2],[1,1898,93,8,"permission"],[1,1906,93,27,"Notification"],[1,1919,93,40,"requestPermission"],[1,1939,95,2],[1,1946,94,2,"console"],[1,1954,94,10,"log"],[1,1958,94,14],[1,1998,94,52,"permission"],[1,2001,95,9,"permission"],[1,2002,96,0],[1,2003,101,7,"async"],[1,2018,101,22,"getVapidPublicKey"],[1,2022,102,2],[1,2026,103,4],[1,2032,103,10,"apiBase"],[1,2034,103,20,"getApiBase"],[1,2038,104,4,"console"],[1,2046,104,12,"log"],[1,2050,104,16],[1,2086,104,53],[1,2089,104,56,"apiBase"],[1,2120,105,4],[1,2126,105,10,"response"],[1,2134,105,27,"fetch"],[1,2140,105,33],[1,2143,105,36,"apiBase"],[1,2174,106,4],[1,2178,106,9,"response"],[1,2180,106,18,"ok"],[1,2183,107,6],[1,2189,107,12],[1,2193,107,16,"Error"],[1,2199,107,22],[1,2239,110,4],[1,2252,109,23,"response"],[1,2254,109,32,"json"],[1,2262,110,16,"vapidPublicKey"],[1,2276,111,2],[1,2277,111,4],[1,2283,111,11,"error"],[1,2286,113,4],[1,2293,112,4,"console"],[1,2301,112,12,"error"],[1,2307,112,18],[1,2346,112,58,"error"],[1,2349,113,11],[1,2353,114,2],[1,2354,115,0],[1,2355,120,7,"async"],[1,2370,120,22,"subscribeToWebPush"],[1,2372,120,41,"authToken"],[1,2375,121,2],[1,2379,121,7,"isWebPushSupported"],[1,2383,123,4],[1,2390,122,4,"console"],[1,2398,122,12,"log"],[1,2402,122,16],[1,2437,123,11],[1,2439,127,2],[1,2443,127,6,"token"],[1,2445,127,14,"authToken"],[1,2447,133,2],[1,2450,128,7,"token"],[1,2453,128,40],[1,2473,128,23,"localStorage"],[1,2488,129,4,"token"],[1,2490,129,12,"localStorage"],[1,2503,129,25,"getItem"],[1,2511,129,33],[1,2539,129,58,"undefined"],[1,2541,130,4,"console"],[1,2549,130,12,"log"],[1,2553,130,16],[1,2597,130,61,"token"],[1,2599,130,69],[1,2607,130,76],[1,2615,133,7,"token"],[1,2617,135,4],[1,2624,134,4,"console"],[1,2632,134,12,"error"],[1,2638,134,18],[1,2687,135,11],[1,2689,138,2],[1,2693,140,4,"console"],[1,2701,140,12,"log"],[1,2705,140,16],[1,2750,141,4],[1,2756,141,10,"registration"],[1,2764,141,31,"registerServiceWorker"],[1,2768,142,4],[1,2772,142,9,"registration"],[1,2774,143,6],[1,2780,143,12],[1,2784,143,16,"Error"],[1,2790,143,22],[1,2836,145,4,"console"],[1,2844,145,12,"log"],[1,2848,145,16],[1,2899,148,4,"console"],[1,2907,148,12,"log"],[1,2911,148,16],[1,2956,149,4],[1,2962,149,10,"permission"],[1,2970,149,29,"requestNotificationPermission"],[1,2974,150,4],[1,2977,150,23],[1,2989,150,8,"permission"],[1,2991,152,6],[1,2998,151,6,"console"],[1,3006,151,14,"log"],[1,3010,151,18],[1,3062,151,68,"permission"],[1,3066,152,13],[1,3068,154,4,"console"],[1,3076,154,12,"log"],[1,3080,154,16],[1,3113,157,4,"console"],[1,3121,157,12,"log"],[1,3125,157,16],[1,3164,158,4],[1,3170,158,10,"vapidPublicKey"],[1,3178,158,33,"getVapidPublicKey"],[1,3182,159,4],[1,3186,159,9,"vapidPublicKey"],[1,3188,160,6],[1,3194,160,12],[1,3198,160,16,"Error"],[1,3204,160,22],[1,3244,162,4,"console"],[1,3252,162,12,"log"],[1,3256,162,16],[1,3290,165,4,"console"],[1,3298,165,12,"log"],[1,3302,165,16],[1,3348,166,4],[1,3354,166,10,"subscription"],[1,3362,166,31,"registration"],[1,3364,166,44,"pushManager"],[1,3376,166,56,"subscribe"],[1,3386,166,66],[1,3387,167,6,"userVisibleOnly"],[1,3404,167,23],[1,3406,168,6,"applicationServerKey"],[1,3427,168,28,"urlBase64ToUint8Array"],[1,3429,168,50,"vapidPublicKey"],[1,3434,171,4,"console"],[1,3442,171,12,"log"],[1,3446,171,16],[1,3481,171,49,"subscription"],[1,3483,171,62,"endpoint"],[1,3493,174,4,"console"],[1,3501,174,12,"log"],[1,3505,174,16],[1,3559,175,4],[1,3565,175,10,"subscriptionJson"],[1,3567,175,29,"subscription"],[1,3569,175,42,"toJSON"],[1,3578,176,10,"apiBase"],[1,3580,176,20,"getApiBase"],[1,3584,177,4,"console"],[1,3592,177,12,"log"],[1,3596,177,16],[1,3618,177,39,"apiBase"],[1,3621,178,4,"console"],[1,3629,178,12,"log"],[1,3633,178,16],[1,3671,178,55,"token"],[1,3673,178,61,"substring"],[1,3683,178,71],[1,3685,178,74],[1,3689,178,80],[1,3696,180,4],[1,3702,180,10,"response"],[1,3710,180,27,"fetch"],[1,3716,180,33],[1,3719,180,36,"apiBase"],[1,3742,180,66],[1,3743,181,6,"method"],[1,3750,181,14],[1,3757,182,6,"headers"],[1,3765,182,15],[1,3766,183,8],[1,3781,183,24],[1,3800,184,8,"Authorization"],[1,3814,184,25,"token"],[1,3817,186,6,"body"],[1,3822,186,12,"JSON"],[1,3827,186,17,"stringify"],[1,3837,186,27],[1,3838,187,8,"endpoint"],[1,3847,187,18,"subscription"],[1,3849,187,31,"endpoint"],[1,3858,188,8,"keys"],[1,3863,188,14],[1,3864,189,10,"p256dh"],[1,3871,189,18,"subscriptionJson"],[1,3873,189,35,"keys"],[1,3879,189,41,"p256dh"],[1,3886,190,10,"auth"],[1,3891,190,16,"subscriptionJson"],[1,3893,190,33,"keys"],[1,3899,190,39,"auth"],[1,3909,197,4],[1,3912,195,4,"console"],[1,3920,195,12,"log"],[1,3924,195,16],[1,3959,195,52,"response"],[1,3961,195,61,"status"],[1,3970,197,9,"response"],[1,3972,197,18,"ok"],[1,3975,197,22],[1,3976,198,6],[1,3982,198,12,"errorText"],[1,3990,198,30,"response"],[1,3992,198,39,"text"],[1,3999,200,6],[1,4005,199,6,"console"],[1,4013,199,14,"error"],[1,4019,199,20],[1,4051,199,53,"errorText"],[1,4054,200,12],[1,4058,200,16,"Error"],[1,4064,200,22],[1,4110,200,67,"errorText"],[1,4112,201,4],[1,4113,207,4],[1,4126,204,10,"AsyncStorage"],[1,4128,204,22,"default"],[1,4136,204,23,"setItem"],[1,4144,204,31],[1,4166,204,54],[1,4174,206,4,"console"],[1,4182,206,12,"log"],[1,4186,206,16],[1,4245,207,11],[1,4246,209,2],[1,4247,209,4],[1,4253,209,11,"error"],[1,4256,211,4],[1,4263,210,4,"console"],[1,4271,210,12,"error"],[1,4277,210,18],[1,4308,210,50,"error"],[1,4312,211,11],[1,4313,212,2],[1,4314,213,0],[1,4315,252,7,"async"],[1,4330,252,22,"isSubscribedToWebPush"],[1,4334,253,2],[1,4339,253,33],[1,4357,253,52,"navigator"],[1,4368,254,4],[1,4375,254,11],[1,4377,257,2],[1,4381,258,4],[1,4387,258,10,"registration"],[1,4395,258,31,"navigator"],[1,4405,258,41,"serviceWorker"],[1,4419,258,55,"ready"],[1,4425,260,4],[1,4432,260,28],[1,4445,259,31,"registration"],[1,4447,259,44,"pushManager"],[1,4459,259,56,"getSubscription"],[1,4476,261,2],[1,4477,261,4],[1,4483,261,11,"error"],[1,4486,262,4],[1,4493,262,11],[1,4494,263,2],[1,4495,264,0],[1,4496,280,1],[1,4499]],"functionMap":{"names":["<global>","getApiBase","urlBase64ToUint8Array","isWebPushSupported","getNotificationPermission","registerServiceWorker","requestNotificationPermission","getVapidPublicKey","subscribeToWebPush","unsubscribeFromWebPush","isSubscribedToWebPush","initWebPushIfPermitted"],"mappings":"AAA;mBCU;CDW;AEK;CFa;OGK;CHQ;OIK;CJG;OKK;CLiB;OMK;CNQ;OOK;CPc;OQK;CR6F;OSK;CT6B;OUK;CVY;OWK;CXW"},"hasCjsExports":false},"type":"js/module"}]}