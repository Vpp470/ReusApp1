{"dependencies":[{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":174},"end":{"line":7,"column":69,"index":243}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"expo-constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":244},"end":{"line":8,"column":39,"index":283}}],"key":"pPv5KzfRT0rL6NCr7G9k0o4d1W8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,_i,a,m,_e,d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),_e.isWebPushSupported=s,_e.getNotificationPermission=c,_e.registerServiceWorker=u,_e.requestNotificationPermission=l,_e.getVapidPublicKey=b,_e.subscribeToWebPush=h,_e.unsubscribeFromWebPush=async function(e){try{const t=await navigator.serviceWorker.ready,i=await t.pushManager.getSubscription();i&&await i.unsubscribe();const s=n();return await fetch(`${s}/web-push/unsubscribe`,{method:'DELETE',headers:{Authorization:e}}),await o.default.removeItem('web_push_subscribed'),console.log('[WebPush] Dessubscrit correctament'),!0}catch(e){return console.error('[WebPush] Error dessubscrivint:',e),!1}},_e.isSubscribedToWebPush=p,_e.initWebPushIfPermitted=async function(e){if(!s())return;if('granted'===c()){await p()||(console.log('[WebPush] Re-subscrivint usuari amb perm\\xeds existent...'),await h(e))}},r(d[0]);var o=e(r(d[1])),t=e(r(d[2]));const n=()=>{const e=t.default.expoConfig?.extra?.EXPO_PUBLIC_BACKEND_URL||\"https://www.reusapp.com\";return e?`${e}/api`:'/api'};function i(e){const o=(e+'='.repeat((4-e.length%4)%4)).replace(/-/g,'+').replace(/_/g,'/'),t=window.atob(o),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}function s(){return'serviceWorker'in navigator&&'PushManager'in window&&'Notification'in window}function c(){return'Notification'in window?Notification.permission:null}async function u(){if(!('serviceWorker'in navigator))return console.log('[WebPush] Service Worker no suportat'),null;try{const e=await navigator.serviceWorker.register('/sw.js',{scope:'/'});return console.log('[WebPush] Service Worker registrat:',e.scope),e}catch(e){return console.error('[WebPush] Error registrant Service Worker:',e),null}}async function l(){if(!('Notification'in window))return'denied';const e=await Notification.requestPermission();return console.log('[WebPush] Perm\\xeds de notificacions:',e),e}async function b(){try{const e=n();console.log('[WebPush] Obtenint clau VAPID de:',`${e}/web-push/vapid-public-key`);const o=await fetch(`${e}/web-push/vapid-public-key`);if(!o.ok)throw new Error('No s\\'ha pogut obtenir la clau VAPID');return(await o.json()).vapidPublicKey}catch(e){return console.error('[WebPush] Error obtenint clau VAPID:',e),null}}async function h(e){if(!s())return console.log('[WebPush] Web Push no suportat'),!1;let t=e;if(t||'undefined'==typeof localStorage||(t=localStorage.getItem('reusapp_auth_token')||void 0,console.log('[WebPush] Token obtingut de localStorage:',t?'S\\xcd':'NO')),!t)return console.error('[WebPush] No hi ha token d\\'autenticaci\\xf3!'),!1;try{console.log('[WebPush] 1. Registrant Service Worker...');const e=await u();if(!e)throw new Error('No s\\'ha pogut registrar el Service Worker');console.log('[WebPush] Service Worker registrat correctament'),console.log('[WebPush] 2. Sol\\xb7licitant perm\\xeds...');const s=await l();if('granted'!==s)return console.log('[WebPush] Perm\\xeds de notificacions no concedit:',s),!1;console.log('[WebPush] Perm\\xeds concedit!'),console.log('[WebPush] 3. Obtenint clau VAPID...');const c=await b();if(!c)throw new Error('No s\\'ha pogut obtenir la clau VAPID');console.log('[WebPush] Clau VAPID obtinguda'),console.log('[WebPush] 4. Creant subscripci\\xf3 push...');const h=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i(c)});console.log('[WebPush] Subscripci\\xf3 creada:',h.endpoint),console.log('[WebPush] 5. Enviant subscripci\\xf3 al servidor...');const p=h.toJSON(),P=n();console.log('[WebPush] API Base:',P),console.log('[WebPush] Token (primers 20 chars):',t.substring(0,20)+'...');const w=await fetch(`${P}/web-push/subscribe`,{method:'POST',headers:{'Content-Type':'application/json',Authorization:t},body:JSON.stringify({endpoint:h.endpoint,keys:{p256dh:p.keys?.p256dh,auth:p.keys?.auth}})});if(console.log('[WebPush] Resposta del servidor:',w.status),!w.ok){const e=await w.text();throw console.error('[WebPush] Error del servidor:',e),new Error('Error guardant subscripci\\xf3 al servidor: '+e)}return await o.default.setItem('web_push_subscribed','true'),console.log('[WebPush] \\u2705 Subscripci\\xf3 completada amb \\xe8xit'),!0}catch(e){return console.error('[WebPush] Error subscrivint:',e),!1}}async function p(){if(!('serviceWorker'in navigator))return!1;try{const e=await navigator.serviceWorker.ready;return null!==await e.pushManager.getSubscription()}catch(e){return!1}}});","lineCount":1,"map":[[1,144,45,0,"_e"],[1,147,45,0,"isWebPushSupported"],[1,168,58,0,"_e"],[1,171,58,0,"getNotificationPermission"],[1,199,66,0,"_e"],[1,202,66,0,"registerServiceWorker"],[1,226,88,0,"_e"],[1,229,88,0,"requestNotificationPermission"],[1,261,101,0,"_e"],[1,264,101,0,"getVapidPublicKey"],[1,284,120,0,"_e"],[1,287,120,0,"subscribeToWebPush"],[1,308,218,0,"_e"],[1,311,218,0,"unsubscribeFromWebPush"],[1,334,218,7,"async"],[1,349,218,45,"authToken"],[1,352,221,2],[1,356,222,4],[1,362,222,10,"registration"],[1,370,222,31,"navigator"],[1,380,222,41,"serviceWorker"],[1,394,222,55,"ready"],[1,400,223,10,"subscription"],[1,408,223,31,"registration"],[1,410,223,44,"pushManager"],[1,422,223,56,"getSubscription"],[1,440,225,8,"subscription"],[1,449,226,12,"subscription"],[1,451,226,25,"unsubscribe"],[1,465,230,4],[1,471,230,10,"apiBase"],[1,473,230,20,"getApiBase"],[1,477,241,4],[1,490,231,10,"fetch"],[1,496,231,16],[1,499,231,19,"apiBase"],[1,524,231,51],[1,525,232,6,"method"],[1,532,232,14],[1,541,233,6,"headers"],[1,549,233,15],[1,550,234,8,"Authorization"],[1,564,234,25,"authToken"],[1,575,238,10,"AsyncStorage"],[1,577,238,22,"default"],[1,585,238,23,"removeItem"],[1,596,238,34],[1,619,240,4,"console"],[1,627,240,12,"log"],[1,631,240,16],[1,670,241,11],[1,671,243,2],[1,672,243,4],[1,678,243,11,"error"],[1,681,245,4],[1,688,244,4,"console"],[1,696,244,12,"error"],[1,702,244,18],[1,736,244,53,"error"],[1,740,245,11],[1,741,246,2],[1,742,247,0],[1,744,252,0,"_e"],[1,747,252,0,"isSubscribedToWebPush"],[1,771,269,0,"_e"],[1,774,269,0,"initWebPushIfPermitted"],[1,797,269,7,"async"],[1,812,269,45,"authToken"],[1,815,270,2],[1,819,270,7,"isWebPushSupported"],[1,823,270,29],[1,830,273,2],[1,833,273,21],[1,845,272,21,"getNotificationPermission"],[1,849,273,32],[1,856,274,31,"isSubscribedToWebPush"],[1,862,276,6,"console"],[1,870,276,14,"log"],[1,874,276,18],[1,941,277,12,"subscribeToWebPush"],[1,943,277,31,"authToken"],[1,946,279,2],[1,947,280,0],[1,949,280,1,"r"],[1,951,280,1,"d"],[1,953,280,1],[1,957,7,0],[1,961,7,0,"AsyncStorage"],[1,963,7,0,"_interopDefault"],[1,965,7,0,"r"],[1,967,7,0,"d"],[1,969,7,0],[1,974,8,0,"Constants"],[1,976,8,0,"_interopDefault"],[1,978,8,0,"r"],[1,980,8,0,"d"],[1,982,8,0],[1,987,11,0],[1,993,11,6,"getApiBase"],[1,995,11,19,"getApiBase"],[1,1000,13,2],[1,1006,13,8,"envUrl"],[1,1008,13,17,"Constants"],[1,1010,13,26,"default"],[1,1018,13,27,"expoConfig"],[1,1030,13,39,"extra"],[1,1037,13,46,"EXPO_PUBLIC_BACKEND_URL"],[1,1062,13,69],[1,1088,16,2],[1,1095,16,6,"envUrl"],[1,1097,17,11],[1,1100,17,14,"envUrl"],[1,1108,21,9],[1,1116,27,0],[1,1125,27,9,"urlBase64ToUint8Array"],[1,1127,27,31,"base64String"],[1,1130,28,2],[1,1136,29,8,"base64"],[1,1139,29,18,"base64String"],[1,1141,28,18],[1,1145,28,22,"repeat"],[1,1153,28,30],[1,1155,28,34,"base64String"],[1,1157,28,47,"length"],[1,1164,28,56],[1,1167,28,61],[1,1171,30,5,"replace"],[1,1179,30,13],[1,1184,30,19],[1,1189,31,5,"replace"],[1,1197,31,13],[1,1202,31,19],[1,1207,33,8,"rawData"],[1,1209,33,18,"window"],[1,1216,33,25,"atob"],[1,1221,33,30,"base64"],[1,1224,34,8,"outputArray"],[1,1226,34,22],[1,1230,34,26,"Uint8Array"],[1,1241,34,37,"rawData"],[1,1243,34,45,"length"],[1,1251,36,2],[1,1255,36,7],[1,1259,36,11,"i"],[1,1261,36,15],[1,1263,36,18,"i"],[1,1265,36,22,"rawData"],[1,1267,36,30,"length"],[1,1276,36,40,"i"],[1,1278,37,4,"outputArray"],[1,1280,37,16,"i"],[1,1283,37,21,"rawData"],[1,1285,37,29,"charCodeAt"],[1,1296,37,40,"i"],[1,1299,39,2],[1,1306,39,9,"outputArray"],[1,1307,40,0],[1,1308,45,7],[1,1317,45,16,"isWebPushSupported"],[1,1321,48,2],[1,1327,49,4],[1,1345,49,23,"navigator"],[1,1356,50,4],[1,1372,50,21,"window"],[1,1380,51,4],[1,1397,51,22,"window"],[1,1403,53,0],[1,1404,58,7],[1,1413,58,16,"getNotificationPermission"],[1,1417,59,2],[1,1423,59,33],[1,1440,59,51,"window"],[1,1447,60,9,"Notification"],[1,1460,60,22,"permission"],[1,1471,59,67],[1,1475,61,0],[1,1476,66,7,"async"],[1,1491,66,22,"registerServiceWorker"],[1,1495,67,2],[1,1500,67,33],[1,1518,67,52,"navigator"],[1,1529,69,4],[1,1536,68,4,"console"],[1,1544,68,12,"log"],[1,1548,68,16],[1,1588,69,11],[1,1593,72,2],[1,1597,73,4],[1,1603,73,10,"registration"],[1,1611,73,31,"navigator"],[1,1621,73,41,"serviceWorker"],[1,1635,73,55,"register"],[1,1644,73,64],[1,1653,73,74],[1,1654,74,6,"scope"],[1,1660,74,13],[1,1666,78,4],[1,1673,77,4,"console"],[1,1681,77,12,"log"],[1,1685,77,16],[1,1723,77,55,"registration"],[1,1725,77,68,"scope"],[1,1732,78,11,"registration"],[1,1733,79,2],[1,1734,79,4],[1,1740,79,11,"error"],[1,1743,81,4],[1,1750,80,4,"console"],[1,1758,80,12,"error"],[1,1764,80,18],[1,1809,80,64,"error"],[1,1812,81,11],[1,1816,82,2],[1,1817,83,0],[1,1818,88,7,"async"],[1,1833,88,22,"requestNotificationPermission"],[1,1837,89,2],[1,1842,89,33],[1,1859,89,51,"window"],[1,1867,90,4],[1,1873,90,11],[1,1882,93,2],[1,1888,93,8,"permission"],[1,1896,93,27,"Notification"],[1,1909,93,40,"requestPermission"],[1,1929,95,2],[1,1936,94,2,"console"],[1,1944,94,10,"log"],[1,1948,94,14],[1,1988,94,52,"permission"],[1,1991,95,9,"permission"],[1,1992,96,0],[1,1993,101,7,"async"],[1,2008,101,22,"getVapidPublicKey"],[1,2012,102,2],[1,2016,103,4],[1,2022,103,10,"apiBase"],[1,2024,103,20,"getApiBase"],[1,2028,104,4,"console"],[1,2036,104,12,"log"],[1,2040,104,16],[1,2076,104,53],[1,2079,104,56,"apiBase"],[1,2110,105,4],[1,2116,105,10,"response"],[1,2124,105,27,"fetch"],[1,2130,105,33],[1,2133,105,36,"apiBase"],[1,2164,106,4],[1,2168,106,9,"response"],[1,2170,106,18,"ok"],[1,2173,107,6],[1,2179,107,12],[1,2183,107,16,"Error"],[1,2189,107,22],[1,2229,110,4],[1,2242,109,23,"response"],[1,2244,109,32,"json"],[1,2252,110,16,"vapidPublicKey"],[1,2266,111,2],[1,2267,111,4],[1,2273,111,11,"error"],[1,2276,113,4],[1,2283,112,4,"console"],[1,2291,112,12,"error"],[1,2297,112,18],[1,2336,112,58,"error"],[1,2339,113,11],[1,2343,114,2],[1,2344,115,0],[1,2345,120,7,"async"],[1,2360,120,22,"subscribeToWebPush"],[1,2362,120,41,"authToken"],[1,2365,121,2],[1,2369,121,7,"isWebPushSupported"],[1,2373,123,4],[1,2380,122,4,"console"],[1,2388,122,12,"log"],[1,2392,122,16],[1,2427,123,11],[1,2429,127,2],[1,2433,127,6,"token"],[1,2435,127,14,"authToken"],[1,2437,133,2],[1,2440,128,7,"token"],[1,2443,128,40],[1,2463,128,23,"localStorage"],[1,2478,129,4,"token"],[1,2480,129,12,"localStorage"],[1,2493,129,25,"getItem"],[1,2501,129,33],[1,2529,129,58,"undefined"],[1,2531,130,4,"console"],[1,2539,130,12,"log"],[1,2543,130,16],[1,2587,130,61,"token"],[1,2589,130,69],[1,2597,130,76],[1,2605,133,7,"token"],[1,2607,135,4],[1,2614,134,4,"console"],[1,2622,134,12,"error"],[1,2628,134,18],[1,2677,135,11],[1,2679,138,2],[1,2683,140,4,"console"],[1,2691,140,12,"log"],[1,2695,140,16],[1,2740,141,4],[1,2746,141,10,"registration"],[1,2754,141,31,"registerServiceWorker"],[1,2758,142,4],[1,2762,142,9,"registration"],[1,2764,143,6],[1,2770,143,12],[1,2774,143,16,"Error"],[1,2780,143,22],[1,2826,145,4,"console"],[1,2834,145,12,"log"],[1,2838,145,16],[1,2889,148,4,"console"],[1,2897,148,12,"log"],[1,2901,148,16],[1,2946,149,4],[1,2952,149,10,"permission"],[1,2960,149,29,"requestNotificationPermission"],[1,2964,150,4],[1,2967,150,23],[1,2979,150,8,"permission"],[1,2981,152,6],[1,2988,151,6,"console"],[1,2996,151,14,"log"],[1,3000,151,18],[1,3052,151,68,"permission"],[1,3056,152,13],[1,3058,154,4,"console"],[1,3066,154,12,"log"],[1,3070,154,16],[1,3103,157,4,"console"],[1,3111,157,12,"log"],[1,3115,157,16],[1,3154,158,4],[1,3160,158,10,"vapidPublicKey"],[1,3168,158,33,"getVapidPublicKey"],[1,3172,159,4],[1,3176,159,9,"vapidPublicKey"],[1,3178,160,6],[1,3184,160,12],[1,3188,160,16,"Error"],[1,3194,160,22],[1,3234,162,4,"console"],[1,3242,162,12,"log"],[1,3246,162,16],[1,3280,165,4,"console"],[1,3288,165,12,"log"],[1,3292,165,16],[1,3338,166,4],[1,3344,166,10,"subscription"],[1,3352,166,31,"registration"],[1,3354,166,44,"pushManager"],[1,3366,166,56,"subscribe"],[1,3376,166,66],[1,3377,167,6,"userVisibleOnly"],[1,3394,167,23],[1,3396,168,6,"applicationServerKey"],[1,3417,168,28,"urlBase64ToUint8Array"],[1,3419,168,50,"vapidPublicKey"],[1,3424,171,4,"console"],[1,3432,171,12,"log"],[1,3436,171,16],[1,3471,171,49,"subscription"],[1,3473,171,62,"endpoint"],[1,3483,174,4,"console"],[1,3491,174,12,"log"],[1,3495,174,16],[1,3549,175,4],[1,3555,175,10,"subscriptionJson"],[1,3557,175,29,"subscription"],[1,3559,175,42,"toJSON"],[1,3568,176,10,"apiBase"],[1,3570,176,20,"getApiBase"],[1,3574,177,4,"console"],[1,3582,177,12,"log"],[1,3586,177,16],[1,3608,177,39,"apiBase"],[1,3611,178,4,"console"],[1,3619,178,12,"log"],[1,3623,178,16],[1,3661,178,55,"token"],[1,3663,178,61,"substring"],[1,3673,178,71],[1,3675,178,74],[1,3679,178,80],[1,3686,180,4],[1,3692,180,10,"response"],[1,3700,180,27,"fetch"],[1,3706,180,33],[1,3709,180,36,"apiBase"],[1,3732,180,66],[1,3733,181,6,"method"],[1,3740,181,14],[1,3747,182,6,"headers"],[1,3755,182,15],[1,3756,183,8],[1,3771,183,24],[1,3790,184,8,"Authorization"],[1,3804,184,25,"token"],[1,3807,186,6,"body"],[1,3812,186,12,"JSON"],[1,3817,186,17,"stringify"],[1,3827,186,27],[1,3828,187,8,"endpoint"],[1,3837,187,18,"subscription"],[1,3839,187,31,"endpoint"],[1,3848,188,8,"keys"],[1,3853,188,14],[1,3854,189,10,"p256dh"],[1,3861,189,18,"subscriptionJson"],[1,3863,189,35,"keys"],[1,3869,189,41,"p256dh"],[1,3876,190,10,"auth"],[1,3881,190,16,"subscriptionJson"],[1,3883,190,33,"keys"],[1,3889,190,39,"auth"],[1,3899,197,4],[1,3902,195,4,"console"],[1,3910,195,12,"log"],[1,3914,195,16],[1,3949,195,52,"response"],[1,3951,195,61,"status"],[1,3960,197,9,"response"],[1,3962,197,18,"ok"],[1,3965,197,22],[1,3966,198,6],[1,3972,198,12,"errorText"],[1,3980,198,30,"response"],[1,3982,198,39,"text"],[1,3989,200,6],[1,3995,199,6,"console"],[1,4003,199,14,"error"],[1,4009,199,20],[1,4041,199,53,"errorText"],[1,4044,200,12],[1,4048,200,16,"Error"],[1,4054,200,22],[1,4100,200,67,"errorText"],[1,4102,201,4],[1,4103,207,4],[1,4116,204,10,"AsyncStorage"],[1,4118,204,22,"default"],[1,4126,204,23,"setItem"],[1,4134,204,31],[1,4156,204,54],[1,4164,206,4,"console"],[1,4172,206,12,"log"],[1,4176,206,16],[1,4235,207,11],[1,4236,209,2],[1,4237,209,4],[1,4243,209,11,"error"],[1,4246,211,4],[1,4253,210,4,"console"],[1,4261,210,12,"error"],[1,4267,210,18],[1,4298,210,50,"error"],[1,4302,211,11],[1,4303,212,2],[1,4304,213,0],[1,4305,252,7,"async"],[1,4320,252,22,"isSubscribedToWebPush"],[1,4324,253,2],[1,4329,253,33],[1,4347,253,52,"navigator"],[1,4358,254,4],[1,4365,254,11],[1,4367,257,2],[1,4371,258,4],[1,4377,258,10,"registration"],[1,4385,258,31,"navigator"],[1,4395,258,41,"serviceWorker"],[1,4409,258,55,"ready"],[1,4415,260,4],[1,4422,260,28],[1,4435,259,31,"registration"],[1,4437,259,44,"pushManager"],[1,4449,259,56,"getSubscription"],[1,4466,261,2],[1,4467,261,4],[1,4473,261,11,"error"],[1,4476,262,4],[1,4483,262,11],[1,4484,263,2],[1,4485,264,0],[1,4486,280,1],[1,4489]],"functionMap":{"names":["<global>","getApiBase","urlBase64ToUint8Array","isWebPushSupported","getNotificationPermission","registerServiceWorker","requestNotificationPermission","getVapidPublicKey","subscribeToWebPush","unsubscribeFromWebPush","isSubscribedToWebPush","initWebPushIfPermitted"],"mappings":"AAA;mBCU;CDW;AEK;CFa;OGK;CHQ;OIK;CJG;OKK;CLiB;OMK;CNQ;OOK;CPc;OQK;CR6F;OSK;CT6B;OUK;CVY;OWK;CXW"},"hasCjsExports":false},"type":"js/module"}]}